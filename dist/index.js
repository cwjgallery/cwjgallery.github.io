"use strict";var ImgLoader=function(){function e(e){this.setsrc(e),this.cache=new Map}return e.prototype.loadimg=function(a){var o=this;return new Promise(function(r,e){var n=new Image;n.src="gallery/"+a,n.onload=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.setImg(a,n),r()},n.onerror=e})},e.prototype.readImg=function(e){return this.cache.has(e)?this.cache.get(e):null},e.prototype.setImg=function(e,t){this.cache.has(e)||this.cache.set(e,t)},e.prototype.setsrc=function(e){this.src=e},e.prototype.loadThumb=function(){var t=this;return Promise.all(this.src.map(function(e){return t.loadimg(e.thumb)}))},e.prototype.loadFull=function(){var t=this;return Promise.all(this.src.map(function(e){return t.loadimg(e.url)}))},e.prototype.getImg=function(e){return this.readImg(e)},e}();function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i}var formatter={formatDate:function(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}},h=function(e,t,r){var n,a,o=document.createElement(e);if(t)try{for(var i=__values(Object.entries(t)),l=i.next();!l.done;l=i.next()){var c=__read(l.value,2),u=c[0],d=c[1];o.setAttribute(u,d)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return r&&(Array.isArray(r)||(r=[r]),r.forEach(function(e){"string"==typeof e?o.innerText=e:o.appendChild(e)})),o},appendFirst=function(e,t){t.children.length?t.insertBefore(e,t.children[0]):t.append(e)},setStyle=function(t,e){Object.entries(e).forEach(function(e){t.style[e[0]]=e[1]})},container=document.body,thumbwrap=h("div",{class:"thumb-wrap"});container.appendChild(thumbwrap);var detailwrap=h("div",{class:"detail-wrap"});detailwrap.addEventListener("click",function(){return setStyle(detailwrap,{display:"none"})}),setStyle(detailwrap,{display:"none"}),container.appendChild(detailwrap);var renderthumb=function(e,n){e.forEach(function(e){var t=n.getImg(e.thumb);t.className="thumbimg",t.addEventListener("click",function(){return openFull(e.url,n)});var r=h("div",{class:"thumb"},[h("div",{class:"desc"},e.desc),h("div",{class:"date"},formatter.formatDate(e.date))]);appendFirst(t,r),thumbwrap.append(r)})},openFull=function(e,t){setStyle(detailwrap,{display:""}),detailwrap.innerHTML="";var r=t.getImg(e);r.className="detail",detailwrap.append(r)},renderFull=function(){},galleryLoader=new ImgLoader(window.__GALLERY_LIST__),list=galleryLoader.src;galleryLoader.loadThumb().then(function(){return renderthumb(list,galleryLoader),galleryLoader.loadFull()}).then(renderFull).catch(function(){console.log("图片加载失败")});
